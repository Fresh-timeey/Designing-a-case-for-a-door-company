<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>АИС "Заказ и установка дверей"</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="door-icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

 <!-- ШАПКА -->
<header>
  <div class="header-content">
    <div class="header-left">
      <img src="door-icon.png" alt="Door Icon" class="logo">
      <h1>АИС "Заказ и установка дверей"</h1>
    </div>
    <div id="userInfo" style="display: none;">
      <div class="user-info-container">
        <div>
          <span id="userName"></span>
          <span id="userRole" style="margin-left: 10px; font-size: 0.9em; padding: 2px 8px; border-radius: 10px;"></span>
        </div>
        <button id="logoutBtn" style="margin-left: 10px; font-size: 0.9em;">Выйти</button>
      </div>
    </div>
  </div>
  <nav>
    <ul>
      <li><button class="nav-btn" data-page="welcome">Главная</button></li>
      <li><button class="nav-btn auth-required" data-page="order" style="display: none;">Сделать заказ</button></li>
      <li><button class="nav-btn auth-required" data-page="view" style="display: none;">Мои заказы</button></li>
      <li><button class="nav-btn" data-page="support">Поддержка</button></li>
      <li><button id="adminBtn" style="display: none;">Администратор</button></li>
    </ul>
  </nav>
</header>

  <main id="content">

    <!-- ГЛАВНАЯ -->
    <section id="welcome" class="page active">
      <div class="intro">
        <h2>Добро пожаловать!</h2>
        <p>Вы находитесь в автоматизированной системе заказа и установки дверей.</p>
      </div>

      <div class="card auth-block">
        <h3>Авторизация</h3>
        <form id="loginForm">
          <label>Логин:</label>
          <input type="text" id="login" placeholder="Введите логин" required>
          <label>Пароль:</label>
          <input type="password" id="password" placeholder="Введите пароль" required>
          <button type="submit">Войти</button>
          <p>Нет аккаунта? <a href="#" id="showRegister">Зарегистрироваться</a></p>
          <p class="note">* Тестовые данные: admin/1111, или user/1111, или worker/1111</p>
        </form>
      </div>

      <div class="card order-block auth-required" style="display: none;">
        <h3>Сделать заказ</h3>
        <form>
          <label>Тип двери:</label>
          <select required>
            <option value="">Выберите тип</option>
            <option>Металлическая</option>
            <option>Деревянная</option>
            <option>Пластиковая</option>
          </select>

          <label>Размер (см):</label>
          <input type="text" placeholder="200x90" required pattern="\d+x\d+">

          <label>Дополнительное описание:</label>
          <input type="text" placeholder="(К прим.) с бордовой обшивкой или стеклянная. Фурнитура, демонтаж старых дверей..." required maxlength="200">

          <label>Адрес установки:</label>
          <input type="text" placeholder="г. Москва, ул. Примерная, д. 5" required>

          <label>Способ оплаты:</label>
          <select required>
            <option value="">Выберите способ оплаты</option>
            <option>Наличные мастеру</option>
            <option>Безналичный перевод</option>
            <option>Переносная касса</option>
          </select>

          <label>Номер телефона для связи или почта:</label>
          <input type="text" placeholder="+7-999-123-45-67 или email@example.com" required>

          <button type="submit">Оформить заказ</button>
        </form>
      </div>
    </section>

    <!-- СТРАНИЦА ЗАКАЗА -->
    <section id="order" class="page">
      <h2>Создать новый заказ</h2>
      <form class="card">
        <label>Тип двери:</label>
        <select required>
          <option value="">Выберите тип</option>
          <option>Металлическая</option>
          <option>Деревянная</option>
          <option>Пластиковая</option>
        </select>

        <label>Размер (см):</label>
        <input type="text" placeholder="200x90" required pattern="\d+x\d+">

        <label>Дополнительное описание:</label>
        <input type="text" placeholder="(К прим.) с бордовой обшивкой или стеклянная. Фурнитура, демонтаж старых дверей..." required maxlength="200">

        <label>Адрес установки:</label>
        <input type="text" placeholder="Введите адрес" required>

        <label>Способ оплаты:</label>
        <select required>
          <option value="">Выберите способ оплаты</option>
          <option>Наличные мастеру</option>
          <option>Безналичный перевод</option>
          <option>Переносная касса</option>
        </select>

        <label>Номер телефона для связи или почта:</label>
        <input type="text" placeholder="+7-999-123-45-67 или email@example.com" required>

        <button type="submit">Создать заказ</button>
      </form>
    </section>

    <!-- ПРОСМОТР ЗАКАЗОВ -->
    <section id="view" class="page">
      <h2>Мои заказы</h2>
      
      <div class="card">
        <h3>Поиск заказа</h3>
        <form>
          <label>Введите номер заказа:</label>
          <input type="text" placeholder="ORD-001">
          <button type="submit">Найти</button>
          <button type="button" onclick="app.view.clearFilters()">Показать все</button>
        </form>
      </div>

      <div class="card">
        <h3>Фильтры</h3>
        <select id="typeFilter">
          <option value="">Все типы</option>
          <option value="Металлическая">Металлическая</option>
          <option value="Деревянная">Деревянная</option>
          <option value="Пластиковая">Пластиковая</option>
        </select>
      </div>

      <div class="card">
        <h3>Список заказов</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Тип двери</th>
              <th>Описание</th>
              <th>Адрес</th>
              <th>Статус</th>
              <th>Дата</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody">
            <!-- Заказы будут загружены через JavaScript -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- ПОДДЕРЖКА -->
    <section id="support" class="page">
      <h2>Служба поддержки</h2>
      <form class="card">
        <label>Ваше имя:</label>
        <input type="text" placeholder="Введите имя" required>
        <label>Email:</label>
        <input type="email" placeholder="Введите email" required>
        <label>Сообщение:</label>
        <textarea placeholder="Опишите проблему..." required></textarea>
        <button type="submit">Отправить сообщение</button>
      </form>
    </section>

  </main>

  <!-- МОДАЛЬНОЕ ОКНО РЕГИСТРАЦИИ -->
  <div id="registerModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-modal" id="closeRegister">&times;</span>
      <h3>Регистрация</h3>
      <form id="registerForm">
        <label>Имя:</label>
        <input type="text" id="regName" placeholder="Введите ваше имя" required>
        
        <label>Логин:</label>
        <input type="text" id="regLogin" placeholder="Введите логин" required>
        
        <label>Пароль:</label>
        <input type="password" id="regPassword" placeholder="Введите пароль" required>
        
        <button type="submit">Зарегистрироваться</button>
      </form>
    </div>
  </div>

  <!-- МОДАЛЬНОЕ ОКНО РЕДАКТИРОВАНИЯ -->
  <div id="editModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Редактировать заказ</h3>
      <form id="editOrderForm">
        <input type="hidden" id="editOrderId">
        
        <label>Тип двери:</label>
        <select id="editOrderType" required>
          <option value="Металлическая">Металлическая</option>
          <option value="Деревянная">Деревянная</option>
          <option value="Пластиковая">Пластиковая</option>
        </select>
        
        <label>Размер (см):</label>
        <input type="text" id="editOrderSize" required pattern="\d+x\d+">
        
        <label>Описание:</label>
        <textarea id="editOrderDescription" required maxlength="200"></textarea>
        
        <label>Адрес установки:</label>
        <input type="text" id="editOrderAddress" required>
        
        <label>Способ оплаты:</label>
        <select id="editOrderPayment" required>
          <option value="Наличные мастеру">Наличные мастеру</option>
          <option value="Безналичный перевод">Безналичный перевод</option>
          <option value="Переносная касса">Переносная касса</option>
        </select>
        
        <label>Контактные данные:</label>
        <input type="text" id="editOrderContact" required>
        
        <label>Статус:</label>
        <select id="editOrderStatus" required>
          <option value="Новый">Новый</option>
          <option value="В работе">В работе</option>
          <option value="Завершено">Завершено</option>
          <option value="Отменено">Отменено</option>
        </select>
        
        <button type="submit">Сохранить изменения</button>
      </form>
    </div>
  </div>

  <!-- ПАНЕЛЬ АДМИНИСТРАТОРА -->
  <div id="adminPanel" class="modal">
    <div class="modal-content admin-panel">
      <span class="close-modal" id="closeAdmin">&times;</span>
      <h2>Панель администратора</h2>
      
      <div class="admin-section">
        <h3>Управление пользователями</h3>
        <div id="adminUsersList" class="users-list">
          <!-- Список пользователей -->
        </div>
      </div>
      
      <div class="admin-section">
        <h3>Все заказы</h3>
        <div id="adminOrdersList" class="orders-list">
          <!-- Все заказы -->
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>© 2025 АИС "Заказ и установка дверей". Все права защищены.</p>
  </footer>

  <script src="script.js"></script>

<script>
    // Навигация между страницами
    const pages = document.querySelectorAll('.page');
    const navBtns = document.querySelectorAll('.nav-btn');

    navBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const page = btn.dataset.page;
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            
            // ПЕРЕИНИЦИАЛИЗИРУЕМ ФОРМЫ ПРИ КАЖДОМ ПЕРЕКЛЮЧЕНИИ СТРАНИЦ
            setTimeout(() => {
                if (app && app.view && app.view._reinitForms) {
                    app.view._reinitForms();
                }
            }, 100);
            
            // ОБНОВЛЯЕМ КОНТЕНТ ПРИ ПЕРЕКЛЮЧЕНИИ СТРАНИЦ
            if (page === 'view') {
                if (app && app.view) {

const searchInput = document.querySelector('#view input[type="text"][placeholder*="номер заказа"]');

        if(searchInput){
            searchInput.value='';
        }
                  app.view.clearFilters();



                    app.view.renderOrders();
                }
            } else if (page === 'welcome' && app && app.view && app.userManager.isWorker()) {
                app.view.renderWorkerOrders();
            }
        });
    });
</script>


<!-- Модальное окно редактирования пользователя -->
<div id="editUserModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>Редактировать пользователя</h3>
        <form id="editUserForm">
            <input type="hidden" id="editUserId">
            
            <label>Имя:</label>
            <input type="text" id="editUserName" required>
            
            <label>Логин:</label>
            <input type="text" id="editUserLogin" required>
            
            <label>Пароль:</label>
            <input type="password" id="editUserPassword" required>
            
            <label>Роль:</label>
            <select id="editUserRole" required>
                <option value="user">Пользователь</option>
                <option value="worker">Работник</option>
                <option value="admin">Администратор</option>
            </select>
            
            <button type="submit">Сохранить изменения</button>
        </form>
    </div>
</div>





<!-- Модальное окно успешного создания заказа -->
<div id="successModal" class="modal success-modal" style="display: none;">
  <div class="modal-content">
    <span class="close-modal" id="closeSuccess">&times;</span>
    <div class="success-icon">✅</div>
    <h3>Заказ успешно создан!</h3>
    <p>Ваш заказ был успешно оформлен и добавлен в систему.</p>
    <button onclick="app.view.hideSuccessModal()">Просмотреть заказ</button>
  </div>
</div>



</body>
</html>